# 📱 消息模板配置 - 可视化预览指南

## 🎯 配置中心 - 渠道配置预览

### 1️⃣ 群机器人配置

```
┌─────────────────────────────────────────────────────────────┐
│  📱 群机器人配置                              [+ 新建模板]   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  机器人列表                                                  │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ ID | 机器人名称      | 群ID            | 操作         │  │
│  ├───────────────────────────────────────────────────────┤  │
│  │ 1  │ 售后服务群      │ wrXXXXXXXXXXXX  │ [编辑][删除] │  │
│  │ 2  │ 销售团队群      │ wrYYYYYYYYYYYY  │ [编辑][删除] │  │
│  │ 3  │ 客服团队群      │ wrZZZZZZZZZZZZ  │ [编辑][删除] │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  [+ 添加群机器人]                                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘

【点击"添加群机器人"后】
┌─────────────────────────────────────────────────────────────┐
│  新增群机器人                                    [×]          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  机器人ID:      [bot_004_________________________]          │
│                 提示：唯一标识符，如 bot_001                  │
│                                                             │
│  机器人名称:    [产品研发群_____________________]            │
│                 提示：便于识别的名称                          │
│                                                             │
│  群ID:          [wrABCDEFGHIJKLM________________]            │
│                 提示：企业微信群的ID                          │
│                                                             │
│  Webhook URL:   [https://qyapi.weixin.qq.com/cgi-bin/____]  │
│                 [_____________________________________]      │
│                 提示：群机器人的webhook地址                   │
│                                                             │
│                           [取消]  [保存]                     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### 2️⃣ 企业微信配置

```
┌─────────────────────────────────────────────────────────────┐
│  ⚙️ 企业微信配置                                             │
├─────────────────────────────────────────────────────────────┤
│  [基础配置] [客服配置] [@智能助手配置]                        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  【基础配置】                                                │
│  CorpID:        [wwXXXXXXXXXXXXXX______________]            │
│                 提示：企业微信的CorpID                        │
│                                                             │
│  CorpSecret:    [••••••••••••••••••••••••••••••]            │
│                 提示：企业微信的Secret（敏感信息）             │
│                                                             │
│  ────────────────────────────────────────────────           │
│                                                             │
│  【客服配置】                                                │
│  Contact Secret: [••••••••••••••••••••••••••••••]           │
│                  提示：客户联系Secret，用于发送给外部客户      │
│                                                             │
│  ────────────────────────────────────────────────           │
│                                                             │
│  【@智能助手配置】                                           │
│  AgentID:        [1000002__________________________]        │
│                  提示：自建应用的AgentID                      │
│                                                             │
│  AgentSecret:    [••••••••••••••••••••••••••••••]           │
│                  提示：应用的Secret                           │
│                                                             │
│  Token:          [xxxxxxxxxxxx_____________________]        │
│                  提示：用于接收消息的Token                     │
│                                                             │
│  EncodingAESKey: [••••••••••••••••••••••••••••••]           │
│                  提示：消息加密密钥                           │
│                                                             │
│  目标群:         [ ☑ 售后服务群 (wrXXXXXXXXXXXX)  ]          │
│                  [ ☑ 销售团队群 (wrYYYYYYYYYYYY)  ]          │
│                  [ ☐ 客服团队群 (wrZZZZZZZZZZZZ)  ]          │
│                  提示：选择@智能助手可以推送消息的群           │
│                                                             │
│                                      [提交]                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### 3️⃣ 微信公众号配置（已有）

```
┌─────────────────────────────────────────────────────────────┐
│  💬 微信公众号配置                                           │
├─────────────────────────────────────────────────────────────┤
│  [公众号配置] [服务器域名配置]                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  AppID:          [wxXXXXXXXXXXXXXX_____________]            │
│                  提示：微信公众号的AppID                      │
│                                                             │
│  AppSecret:      [••••••••••••••••••••••••••••••]           │
│                  提示：微信公众号的AppSecret                  │
│                                                             │
│  关注二维码:     [📷 上传图片]                              │
│                  └─ 当前：qrcode.jpg                        │
│                  提示：引导关注公众号显示的二维码              │
│                                                             │
│  微信校验文件:   [📄 上传文件]                              │
│                  └─ 当前：MP_verify_XXX.txt                 │
│                  提示：配置网页授权域名时下载的校验文件        │
│                                                             │
│  关注是否生成用户: ⚪ 开启  ⚫ 关闭                          │
│                    提示：用户关注后是否自动生成商城用户        │
│                                                             │
│  推广码类型:      ⚫ 商城  ⚪ 公众号                         │
│                   提示：扫码进入商城或推送商城链接             │
│                                                             │
│                                      [提交]                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### 4️⃣ 短信配置（新增）

```
┌─────────────────────────────────────────────────────────────┐
│  📧 短信配置                                                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  服务商选择:     ⚫ 阿里云  ⚪ 腾讯云  ⚪ 华为云              │
│                                                             │
│  AccessKey ID:   [LTAI5tXXXXXXXXXX_____________]            │
│                  提示：阿里云AccessKey ID                    │
│                                                             │
│  AccessKey Secret: [••••••••••••••••••••••••••••••]         │
│                    提示：阿里云AccessKey Secret（敏感信息）   │
│                                                             │
│  签名名称:       [XX公司_________________________]          │
│                  提示：短信签名，如【XX公司】                 │
│                                                             │
│  ────────────────────────────────────────────────           │
│  模板配置                                                    │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 用途        | 模板ID          | 模板内容预览            │  │
│  ├───────────────────────────────────────────────────────┤  │
│  │ 验证码      │ SMS_123456789  │ 验证码${code}，5分钟有效│  │
│  │ 通知        │ SMS_987654321  │ 您的订单${order_no}...  │  │
│  │ 营销        │ SMS_111222333  │ 尊敬的${name}，新品...  │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  [+ 添加模板配置]                        [测试发送] [提交]   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### 5️⃣ 邮件配置（新增）

```
┌─────────────────────────────────────────────────────────────┐
│  ✉️ 邮件配置                                                 │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  SMTP服务器:     [smtp.exmail.qq.com____________]           │
│                  提示：邮件服务器地址                         │
│                                                             │
│  SMTP端口:       [465___]  ☑ 使用SSL                        │
│                  提示：常用端口 465(SSL) / 587(TLS) / 25     │
│                                                             │
│  发送账号:       [noreply@example.com________]              │
│                  提示：发送邮件的账号                         │
│                                                             │
│  密码/授权码:    [••••••••••••••••••••••••••••••]           │
│                  提示：SMTP密码或授权码                       │
│                                                             │
│  发件人名称:     [XX公司客服______________________]          │
│                  提示：邮件显示的发件人名称                   │
│                                                             │
│  发件人邮箱:     [noreply@example.com________]              │
│                  提示：邮件显示的发件人邮箱                   │
│                                                             │
│                                [测试邮件] [提交]             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 📝 消息模板管理 - 预览示例

### GROUP_BOT 模板预览

```
┌─────────────────────────────────────────────────────────────┐
│  新建模板                                          [×]        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  * 模板名称:    [每日工作提醒___________________]            │
│                                                             │
│  * 分类:        [▼ 系统通知___________________]             │
│                 └─ 系统通知 / 营销推广 / 服务通知 / 其他      │
│                                                             │
│  使用场景:      ⚪ 简文本  ⚫ Markdown  ⚪ HTML              │
│                                                             │
│  * 模板内容:                                                 │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 📅 今日工作提醒（{current_date}）                      │  │
│  │                                                       │  │
│  │ 待处理工单：{pending_count} ↑                         │  │
│  │ 进行中工单：{processing_count} ↑                      │  │
│  │ 已完成工单：{completed_count} ↑                       │  │
│  │                                                       │  │
│  │ 请各位同事及时跟进，保证服务质量！                      │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  💡 支持的变量：                                             │
│  ─────────────────────────────────────────────────         │
│  [{customer_name}] [{phone}] [{project_id}] [{order_no}]   │
│  [{current_date}] [{current_time}] [{customer_id}]         │
│  [{project_name}] [{order_amount}] [{ai_reply}]            │
│  ─────────────────────────────────────────────────         │
│  点击变量可快速插入                                          │
│                                                             │
│  * 推送模式:    ⚫ 定时推送  ⚪ 实时推送                      │
│                                                             │
│  * 发送时间:    [2024-02-03] [09:00] 🕐                     │
│                                                             │
│  重复周期:      [▼ 每日___________________]                 │
│                 └─ 仅一次 / 每日 / 每周 / 每月               │
│                                                             │
│  * 发送对象:    [▼ 售后服务群 (bot_001)___]                 │
│                 └─ 售后服务群                               │
│                    销售团队群                               │
│                    客服团队群                               │
│                                                             │
│  ────────────────────────────────────────────────           │
│                                                             │
│  快捷操作:      [预览效果]  [测试发送]                       │
│                                                             │
│                           [取消]  [保存]                     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**点击"预览效果"后显示：**

```
┌─────────────────────────────────────────────────────────────┐
│  模板预览                                          [×]        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  使用场景:      系统通知                                     │
│  推送类型:      定时推送                                     │
│  消息类型:      Markdown                                    │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                   GROUP_BOT                         │    │
│  │                                                     │    │
│  │   📅 今日工作提醒（2024-02-02）                     │    │
│  │                                                     │    │
│  │   待处理工单：{pending_count} ↑                     │    │
│  │   进行中工单：{processing_count} ↑                  │    │
│  │   已完成工单：{completed_count} ↑                   │    │
│  │                                                     │    │
│  │   请各位同事及时跟进，保证服务质量！                 │    │
│  │                                                     │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### WORK_WECHAT 模板预览

```
┌─────────────────────────────────────────────────────────────┐
│  新建模板 - 企业微信客服                            [×]       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  * 模板名称:    [项目进度通知___________________]            │
│                                                             │
│  * 分类:        [▼ 服务通知___________________]             │
│                                                             │
│  * 模板内容:                                                 │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 尊敬的{customer_name}，您好！                         │  │
│  │                                                       │  │
│  │ 您的项目【{project_name}】有新进展：                  │  │
│  │ 当前进度：{progress}%                                 │  │
│  │ 项目状态：{status}                                    │  │
│  │                                                       │  │
│  │ 💡 点击查看详细进度报告：                             │  │
│  │ {secure_link}                                         │  │
│  │                                                       │  │
│  │ ⏰ 页面将每30分钟自动更新                             │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  * 推送模式:    ⚪ 定时推送  ⚫ 实时推送                      │
│                                                             │
│  触发关键词:    [进度] [查询] [项目]                         │
│                 提示：客户发送关键词时自动推送                │
│                                                             │
│  * 发送对象:    ⚫ 外部联系人  ⚪ 部门  ⚪ 标签               │
│                                                             │
│  客户筛选:      ☑ 仅正式客户（customer_type = 'customer'）   │
│                 ☑ 有有效订单（has_active_order = true）      │
│                 ☑ 已通过验证（is_verified = true）           │
│                                                             │
│                           [预览]  [测试]  [保存]             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### WECHAT 模板预览

```
┌─────────────────────────────────────────────────────────────┐
│  新建模板 - 微信公众号                              [×]       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  * 模板名称:    [订单确认通知___________________]            │
│                                                             │
│  * 分类:        [▼ 订单通知___________________]             │
│                                                             │
│  消息类型:      ⚫ 模板消息  ⚪ 客服消息  ⚪ 图文消息          │
│                                                             │
│  * 模板内容:                                                 │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 订单号：{order_no}                                    │  │
│  │ 订单金额：¥{order_amount}                            │  │
│  │ 下单时间：{order_time}                                │  │
│  │ 订单状态：{status}                                    │  │
│  │                                                       │  │
│  │ 感谢您的支持！                                        │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  * 推送模式:    ⚪ 定时推送  ⚫ 实时推送                      │
│                                                             │
│  * 发送对象:    ⚫ 所有粉丝  ⚪ 标签粉丝                      │
│                                                             │
│  粉丝筛选:      ☑ 已关注（is_subscribed = true）             │
│                 ☐ 特定标签（tag_ids = [...]）               │
│                                                             │
│                           [预览]  [测试]  [保存]             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

### AI 模板预览（@智能助手）

```
┌─────────────────────────────────────────────────────────────┐
│  新建模板 - @智能助手                               [×]       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  * 模板名称:    [智能工单分配___________________]            │
│                                                             │
│  * 分类:        [▼ 工单管理___________________]             │
│                                                             │
│  * 模板内容:                                                 │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 🔧 【自动创建工单】                                   │  │
│  │                                                       │  │
│  │ 工单号：{ticket_no}                                   │  │
│  │ 客户：{customer_name}（{phone}）                      │  │
│  │ 项目：{project_name}                                  │  │
│  │ 问题：{issue_description}                             │  │
│  │ 处理状态：待分配                                      │  │
│  │ 创建时间：{created_at}                                │  │
│  │                                                       │  │
│  │ 📋 工单详情：{secure_link}                            │  │
│  │                                                       │  │
│  │ 请相关人员尽快处理。@全体成员                          │  │
│  │                                                       │  │
│  │ 💡 后续操作（需要@机器人）：                          │  │
│  │ 分配工单：@智能助手 /分配工单 {ticket_no} @员工       │  │
│  │ 查询工单：@智能助手 /查询工单 {ticket_no}             │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  * 推送模式:    ⚪ 定时推送  ⚫ 实时推送                      │
│                                                             │
│  触发条件:      [▼ 工单创建时_________________]              │
│                 └─ 工单创建时 / 工单更新时 / 手动触发         │
│                                                             │
│  * 目标群:      ☑ 售后服务群                                │
│                 ☑ 销售团队群                                │
│                 ☐ 客服团队群                                │
│                                                             │
│                           [预览]  [测试]  [保存]             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔧 测试发送界面预览

```
┌─────────────────────────────────────────────────────────────┐
│  测试发送                                          [×]        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  模板：每日工作提醒                                          │
│  模块：GROUP_BOT                                            │
│                                                             │
│  ────────────────────────────────────────────────           │
│  变量赋值                                                    │
│  ────────────────────────────────────────────────           │
│                                                             │
│  current_date:       [2024-02-03______________]             │
│  pending_count:      [5________________________]            │
│  processing_count:   [12_______________________]            │
│  completed_count:    [38_______________________]            │
│                                                             │
│  ────────────────────────────────────────────────           │
│  发送目标                                                    │
│  ────────────────────────────────────────────────           │
│                                                             │
│  目标群机器人:   [▼ 售后服务群 (bot_001)___]                │
│                                                             │
│  ────────────────────────────────────────────────           │
│  预览效果                                                    │
│  ────────────────────────────────────────────────           │
│  ┌───────────────────────────────────────────────────────┐  │
│  │ 📅 今日工作提醒（2024-02-03）                         │  │
│  │                                                       │  │
│  │ 待处理工单：5 ↑                                       │  │
│  │ 进行中工单：12 ↑                                      │  │
│  │ 已完成工单：38 ↑                                      │  │
│  │                                                       │  │
│  │ 请各位同事及时跟进，保证服务质量！                      │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│                           [取消]  [确认发送]                │
│                                                             │
└─────────────────────────────────────────────────────────────┘

【点击"确认发送"后】
┌─────────────────────────────────────────────────────────────┐
│  发送结果                                          [×]        │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ✅ 发送成功                                                │
│                                                             │
│  消息ID:      MSG20240203001                                │
│  发送时间:    2024-02-03 09:35:22                           │
│  目标:        售后服务群 (wrXXXXXXXXXXXX)                   │
│  发送渠道:    GROUP_BOT                                     │
│                                                             │
│  您可以在群中查看推送的消息                                  │
│                                                             │
│                                  [确定]                     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 📊 模板列表界面预览

```
┌─────────────────────────────────────────────────────────────┐
│  📨 消息模板管理                              [+ 新建模板]   │
├─────────────────────────────────────────────────────────────┤
│  [短信模板] [邮件] [消息列表] [群机器人] [@智能助手] [...]  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  模板ID | 模板名称      | 分类    | 推送模式 | 状态 | 操作  │
│  ────────────────────────────────────────────────────────  │
│  7      | 每日工作提醒  | 系统通知 | 定时推送 | 启用 | [...]│
│         | GROUP_BOT     | 每日9:00 | 售后服务群              │
│  ────────────────────────────────────────────────────────  │
│  8      | 项目进度通知  | 服务通知 | 实时推送 | 启用 | [...]│
│         | WORK_WECHAT   | 关键词触发 | 外部联系人            │
│  ────────────────────────────────────────────────────────  │
│  9      | 订单确认通知  | 订单通知 | 实时推送 | 启用 | [...]│
│         | WECHAT        | 订单创建时 | 所有粉丝              │
│  ────────────────────────────────────────────────────────  │
│  10     | 智能工单分配  | 工单管理 | 实时推送 | 启用 | [...]│
│         | AI            | 工单创建时 | 售后服务群+销售团队群  │
│  ────────────────────────────────────────────────────────  │
│                                                             │
│  操作下拉菜单：                                              │
│  • 编辑                                                     │
│  • 预览                                                     │
│  • 测试发送                                                 │
│  • 复制                                                     │
│  • 启用/禁用                                                │
│  • 删除                                                     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 💡 配置流程总览

```
步骤1：配置渠道
├─ 配置中心 → 群机器人配置 → 添加3个群机器人
├─ 配置中心 → 企业微信配置 → 配置@智能助手
├─ 配置中心 → 微信公众号配置 → 输入AppID/Secret
├─ 配置中心 → 短信配置 → 选择服务商并配置
└─ 配置中心 → 邮件配置 → 配置SMTP服务器

↓

步骤2：创建模板
├─ 模板管理 → 新建模板 → 选择GROUP_BOT
│  ├─ 填写模板名称、内容
│  ├─ 选择推送模式（定时/实时）
│  ├─ 绑定目标群机器人
│  └─ 保存
│
├─ 模板管理 → 新建模板 → 选择WORK_WECHAT
│  ├─ 填写模板内容
│  ├─ 选择实时推送+关键词触发
│  ├─ 设置客户筛选条件
│  └─ 保存
│
└─ 模板管理 → 新建模板 → 选择AI
   ├─ 填写@智能助手推送内容
   ├─ 选择触发条件
   ├─ 选择目标群
   └─ 保存

↓

步骤3：测试发送
├─ 模板列表 → 操作 → 测试发送
├─ 填写变量值
├─ 选择发送目标
├─ 预览效果
└─ 确认发送

↓

步骤4：启用模板
└─ 模板列表 → 操作 → 启用
   └─ 系统自动按配置发送消息
```

---

## ✅ 配置完成检查清单

```
[ ] 1. 配置中心 - 群机器人配置
    [ ] 添加至少1个群机器人
    [ ] 测试webhook是否正常

[ ] 2. 配置中心 - 企业微信配置
    [ ] 配置CorpID和Secret
    [ ] 配置@智能助手（AgentID、Secret）
    [ ] 选择目标群

[ ] 3. 配置中心 - 微信公众号配置
    [ ] 配置AppID和AppSecret
    [ ] 上传关注二维码
    [ ] 测试AccessToken获取

[ ] 4. 配置中心 - 短信配置（可选）
    [ ] 选择服务商
    [ ] 配置AccessKey
    [ ] 添加模板ID

[ ] 5. 配置中心 - 邮件配置（可选）
    [ ] 配置SMTP服务器
    [ ] 配置发送账号
    [ ] 测试发送邮件

[ ] 6. 创建消息模板
    [ ] 创建GROUP_BOT模板
    [ ] 创建WORK_WECHAT模板
    [ ] 创建AI模板
    [ ] 测试每个模板

[ ] 7. 启用模板
    [ ] 确认定时任务正常运行
    [ ] 确认实时推送触发正常
    [ ] 查看发送记录
```

---

**🎉 配置完成后，您的消息系统就可以全自动运行了！**
