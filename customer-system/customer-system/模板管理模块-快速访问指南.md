# 模板管理模块 - 快速访问指南

## 🚀 直接访问方法

### 方法1️⃣：直接URL访问（最快）
```
浏览器地址栏输入：
http://localhost:3000/config-center
```
按Enter键直接进入配置中心，找到"模板管理"选项卡

---

### 方法2️⃣：通过菜单导航（推荐）
```
1. 打开 http://localhost:3000
2. 点击左侧菜单栏 → 🔧 配置中心
3. 选择顶部标签中的"模板管理"
```

---

### 方法3️⃣：快速导航（如有快捷菜单）
```
1. 打开应用后台
2. 在顶部导航或快捷菜单中找到"模板管理"
3. 点击进入
```

---

## 📝 四种项目链接配置详解

### 🎯 现有四种链接配置（已完全支持）

| # | 名称 | URL | 说明 |
|----|------|-----|------|
| 1️⃣ | 售前商机详情 | `http://localhost:3000/project/{order_id}?type=presale` | 展示商机详情、跟进记录、销售信息 |
| 2️⃣ | 售后工单详情 | `http://localhost:3000/project/{order_id}?type=aftersales` | 展示工单进度、工程师信息、反馈表单 |
| 3️⃣ | 销售订单详情 | `http://localhost:3000/project/{order_id}?type=sales` | 展示订单信息、支付状态、物流跟踪 |
| 4️⃣ | 在线支付 | `http://localhost:3000/pay/{order_id}` | 支付页面（自定义链接类型） |

---

## 🎨 在模板中使用链接

### 第1步：创建新模板
```
1. 进入模板管理模块
2. 选择消息类型（短信/邮件/微信等）
3. 点击"+ 新建模板"按钮
```

### 第2步：配置链接
```
在"跳转链接"区域：

1. 打开"链接类型"下拉菜单
   ▼ 选择链接类型
   
2. 选择对应选项：
   ✓ 自定义链接
   ✓ 售前商机详情     ← presale
   ✓ 售后工单详情     ← aftersales
   ✓ 销售订单详情     ← sales
   ✓ 项目状态查询     ← status-query

3. 系统会自动显示URL模板提示
   (点击可快速插入)

4. 在"模板内容"中使用变量和链接
```

### 第3步：模板内容写法
```
推荐写法1：带可视按钮的HTML（微信/邮件）
───────────────────────────────────
尊敬的 {customer_name}，

您的订单 {order_id} 已确认！
订单金额：¥{total_amount}

👇 点击下方按钮查看订单详情

[点击查看订单详情]
(http://localhost:3000/project/{order_id}?type=sales)

感谢您的支持！

───────────────────────────────────

推荐写法2：纯文本（短信/企业微信）
───────────────────────────────────
{customer_name}，您的订单{order_id}已确认。
金额¥{total_amount}
点击查看：http://localhost:3000/project/{order_id}?type=sales

───────────────────────────────────

推荐写法3：动态链接（微信卡片）
───────────────────────────────────
{customer_name}，您有一个工单需要处理：

工单编号：{order_id}
状态：{status}
优先级：{priority}

👉 处理链接：
http://localhost:3000/project/{order_id}?type=aftersales

───────────────────────────────────
```

---

## 💻 现有配置（在TemplateManager.vue中）

### 已配置的链接类型（代码位置）

```vue
<!-- 文件: frontend/src/views/TemplateManager.vue, 第135-138行 -->

<el-select v-model="templateForm.link_type" placeholder="选择链接类型">
  <el-option label="自定义链接" value="custom"></el-option>
  <el-option label="售前商机详情" value="presale"></el-option>
  <el-option label="售后工单详情" value="aftersales"></el-option>
  <el-option label="销售订单详情" value="sales"></el-option>
  <el-option label="项目状态查询" value="status-query"></el-option>
</el-select>
```

### URL映射（代码位置）

```vue
<!-- 文件: frontend/src/views/TemplateManager.vue, 第149-186行 -->

<!-- 售前商机 -->
<el-tag v-if="templateForm.link_type === 'presale'">
  售前商机: http://localhost:3000/project/{order_id}?type=presale
</el-tag>

<!-- 售后工单 -->
<el-tag v-if="templateForm.link_type === 'aftersales'">
  售后工单: http://localhost:3000/project/{order_id}?type=aftersales
</el-tag>

<!-- 销售订单 -->
<el-tag v-if="templateForm.link_type === 'sales'">
  销售订单: http://localhost:3000/project/{order_id}?type=sales
</el-tag>

<!-- 支付页面 -->
<el-tag v-if="templateForm.link_type === 'custom'">
  付款页面: http://localhost:3000/pay/{order_id}
</el-tag>

<!-- 项目状态 -->
<el-tag v-if="templateForm.link_type === 'status-query'">
  项目状态: http://localhost:3000/project/{order_id}?type=status
</el-tag>
```

---

## 📱 微信APP适配说明

### ✅ 已适配的功能

| 功能 | 状态 | 说明 |
|------|------|------|
| 响应式设计 | ✅ | 自动适配手机屏幕 |
| 触摸交互 | ✅ | 按钮大小和间距适配 |
| 微信内置浏览器 | ✅ | 完全支持 |
| 返回按钮 | ✅ | 支持微信返回聊天 |
| 分享功能 | ✅ | 支持分享给朋友 |
| 支付接口 | ✅ | 微信支付集成 |

### ⚠️ 需要配置的部分

**当前开发环境的限制：**
```
localhost:3000 是本地地址，微信无法直接访问

需要配置以下之一：
1. 公网域名 + HTTPS
2. 内网穿透（ngrok等）
3. 企业微信可信域名
```

**解决方案：**

#### 方案A：使用ngrok进行开发测试
```bash
# 1. 安装ngrok（如未安装）
# 访问 https://ngrok.com 注册和下载

# 2. 运行ngrok
ngrok http 3000

# 3. 得到公网URL
# 输出会显示：https://xxxx-xxxx-xxxx.ngrok.io

# 4. 在模板中使用该URL
# https://xxxx-xxxx-xxxx.ngrok.io/project/{order_id}?type=presale
```

#### 方案B：配置生产环境域名
```
1. 购买域名（如 example.com）
2. 配置DNS记录指向服务器
3. 申请HTTPS证书
4. 在模板中使用：
   https://example.com/project/{order_id}?type=presale
```

#### 方案C：企业微信（内部使用）
```
如果使用企业微信，可：
1. 在企业应用中配置可信域名
2. 可以使用内网IP或域名
3. 在应用中直接打开链接
```

---

## 🔍 测试链接

### 在浏览器中测试（桌面）
```
1. 在地址栏输入：
   http://localhost:3000/project/PRJ20240101?type=presale

2. 应该看到商机详情页面
   ✓ 项目信息
   ✓ 跟进记录
   ✓ 销售信息
   ✓ 按钮可点击

3. 点击链接确保能正常跳转

4. 测试所有四种类型
```

### 在手机上测试（移动）
```
1. 配置ngrok或域名后
2. 在手机浏览器中访问：
   https://xxx.ngrok.io/project/PRJ20240101?type=presale

3. 验证：
   ✓ 页面正常显示
   ✓ 按钮尺寸合适
   ✓ 文字可读
   ✓ 可以滚动和操作
```

### 在微信APP中测试
```
1. 创建测试消息模板
2. 发送包含链接的消息
3. 在微信APP中点击链接
4. 验证：
   ✓ 在微信内置浏览器中打开
   ✓ 可以返回聊天
   ✓ 可以分享链接
   ✓ 所有功能正常
```

---

## 🎯 四种项目类型的具体应用场景

### 1️⃣ 售前商机详情 (presale)

**何时使用：**
- 商机状态变化（新增、更新跟进）
- 商机即将成交提醒
- 商机信息查询

**模板示例：**
```
尊敬的 {customer_name}，

销售顾问 {salesman_name} 为您提交了一个商机。

📊 商机信息：
• 预期金额：¥{amount}
• 预期成交时间：{expected_close_date}
• 当前进度：{status}

👉 点击查看详细信息和跟进记录
[点击查看商机详情]
http://localhost:3000/project/{order_id}?type=presale

有任何疑问，请联系销售顾问。
```

**适配手机微信：**
- ✅ 信息展示清晰
- ✅ 金额醒目显示
- ✅ 点击区域大
- ✅ 返回微信后能继续聊天

---

### 2️⃣ 售后工单详情 (aftersales)

**何时使用：**
- 工单已创建通知
- 工单处理进度更新
- 工单待评价提醒
- 工单已完成通知

**模板示例：**
```
尊敬的 {customer_name}，

您的工单 {order_id} 最新进展：

📝 工单信息：
• 故障类型：{description}
• 优先级：{priority}
• 处理进度：{processing_status}

👨‍🔧 负责工程师：{engineer_name}
📞 工程师电话：{engineer_phone}

👉 点击查看工单详情和处理进度
[查看工单详情]
http://localhost:3000/project/{order_id}?type=aftersales

如有急需，可直接致电工程师。
```

**适配手机微信：**
- ✅ 工程师信息突出
- ✅ 电话号码可点击拨号
- ✅ 进度清晰显示
- ✅ 反馈表单易操作

---

### 3️⃣ 销售订单详情 (sales)

**何时使用：**
- 订单确认通知
- 订单待支付提醒
- 订单已发货通知
- 物流进度更新

**模板示例：**
```
亲爱的 {customer_name}，

感谢您的购买！订单 {order_id} 已确认。

🛒 订单信息：
• 订单金额：¥{total_amount}
• 支付状态：{payment_status}
• 预计送达：{delivery_date}
• 收货地址：{shipping_address}

👉 点击查看完整订单信息
[点击查看订单]
http://localhost:3000/project/{order_id}?type=sales

我们会及时通知您的物流进展。
```

**适配手机微信：**
- ✅ 金额清晰显示
- ✅ 地址完整展示
- ✅ 产品列表可滚动
- ✅ 支付状态突出

---

### 4️⃣ 在线支付 (pay)

**何时使用：**
- 订单待支付提醒
- 支付链接分享
- 支付催付
- 支付二维码

**模板示例：**
```
尊敬的 {customer_name}，

您的订单 {order_id} 需要完成支付。

💰 支付信息：
• 订单金额：¥{total_amount}
• 支付方式：微信支付、支付宝、银行卡
• 有效期：24小时内

⏰ 请尽快完成支付，否则订单将被取消。

👉 点击前往支付
[立即支付]
http://localhost:3000/pay/{order_id}

支付完成后，订单将立即发货。
感谢！
```

**适配手机微信：**
- ✅ 支持微信支付快速通道
- ✅ 支付完成自动确认
- ✅ 返回结果清晰
- ✅ 金额大字显示

---

## ✨ 模板配置的高级技巧

### 1. 使用HTML美化（邮件和微信）
```html
<table style="width:100%; border-collapse: collapse;">
  <tr>
    <td style="padding: 10px; background: #f0f0f0;"><strong>订单编号</strong></td>
    <td style="padding: 10px;">{order_id}</td>
  </tr>
  <tr>
    <td style="padding: 10px; background: #f0f0f0;"><strong>订单金额</strong></td>
    <td style="padding: 10px; color: red; font-size: 18px;">¥{total_amount}</td>
  </tr>
</table>
```

### 2. 添加时间显示
```
{order_time} → 系统自动替换为当前时间
{expected_complete} → 预期完成时间
```

### 3. 条件显示（如果支持）
```
根据status显示不同内容：
- status=pending: 显示"待处理"
- status=processing: 显示"处理中"
- status=completed: 显示"已完成"
```

### 4. 分类定向
```
同一个模板可配置多个链接类型的规则
系统自动判断type参数选择对应页面
```

---

## 🔗 相关资源

### 前端文件
- `frontend/src/views/TemplateManager.vue` - 模板管理主组件
- `frontend/src/views/ProjectDetail.vue` - 四种项目详情页面
- `frontend/src/views/PaymentPage.vue` - 支付页面（如需要）

### 后端文件
- `backend/app/routers/project_sync_router.py` - 项目详情API
- `backend/app/routers/pay_router.py` - 支付相关API

### 配置文档
- `消息模板配置指南-链接模块详解.md` - 详细配置说明
- `安全链接与缓存策略-实现报告.md` - 缓存和安全说明

---

## ✅ 配置检查清单

立即可以做：
- [ ] 访问 http://localhost:3000/config-center
- [ ] 进入模板管理模块
- [ ] 创建测试模板
- [ ] 选择链接类型并测试
- [ ] 在浏览器中验证链接正常工作

需要配置的：
- [ ] 设置公网域名或ngrok穿透（用于微信）
- [ ] 配置HTTPS证书
- [ ] 在模板中替换localhost为实际域名

高级配置：
- [ ] 配置AI机器人自动发送
- [ ] 设置定时推送任务
- [ ] 集成CRM触发机制
- [ ] 添加数据分析追踪

---

**现在就可以进入模板管理模块进行配置！** 🚀

访问 http://localhost:3000/config-center 开始使用！
