# é«˜å¹¶å‘æ¶ˆæ¯å¤„ç†ç³»ç»Ÿ - å®Œæ•´å®æ–½æ–¹æ¡ˆ

## ğŸ“‹ ç³»ç»Ÿæ¦‚è¿°

æœ¬ç³»ç»Ÿæ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„**é«˜å¹¶å‘æ¶ˆæ¯å¤„ç†å¹³å°**ï¼Œæ”¯æŒä¿ƒé”€æ´»åŠ¨æœŸé—´æ•°åƒç”¨æˆ·åŒæ—¶å‘èµ·å’¨è¯¢ã€‚ç³»ç»Ÿé‡‡ç”¨**æ¶ˆæ¯é˜Ÿåˆ— + åŠ¨æ€çº¿ç¨‹æ±  + åˆ†å¸ƒå¼é” + é™æµ**çš„æ¶æ„ï¼Œç¡®ä¿é«˜å³°æœŸç¨³å®šè¿è¡Œã€‚

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§

1. **é«˜å¹¶å‘å¤„ç†**
   - åŠ¨æ€å¯æ‰©å±•çº¿ç¨‹æ± ï¼ˆ10-100çº¿ç¨‹è‡ªåŠ¨ä¼¸ç¼©ï¼‰
   - RabbitMQæ¶ˆæ¯é˜Ÿåˆ—å¼‚æ­¥è§£è€¦
   - Redissonåˆ†å¸ƒå¼é”é˜²æ­¢é‡å¤å¤„ç†
   - Sentinelé™æµä¿æŠ¤ç³»ç»Ÿç¨³å®š

2. **å…¨é“¾è·¯è¿½è¸ª**
   - Rediså­˜å‚¨æ¶ˆæ¯é“¾è·¯ï¼ˆqueue â†’ process â†’ send â†’ callbackï¼‰
   - 7å¤©è¿½è¸ªæ•°æ®ä¿ç•™
   - å®æ—¶æ€§èƒ½ç›‘æ§

3. **å¤šæ¸ é“æ”¯æŒ**
   - çŸ­ä¿¡ï¼ˆSMSï¼‰
   - é‚®ç®±ï¼ˆEmailï¼‰
   - APPé€šçŸ¥
   - å¾®ä¿¡å…¬ä¼—å·
   - é£ä¹¦æœºå™¨äºº

4. **å¯è§†åŒ–ç›‘æ§**
   - EChartså®æ—¶æ•°æ®å¤§å±
   - å‘é€æˆåŠŸç‡ã€å“åº”æ—¶é—´ç›‘æ§
   - çº¿ç¨‹æ± çŠ¶æ€ä»ªè¡¨ç›˜

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å‰ç«¯ç›‘æ§å¤§å±                            â”‚
â”‚              Vue 3 + Element Plus + ECharts                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FastAPIåç«¯                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ¶ˆæ¯API    â”‚  â”‚ é™æµä¸­é—´ â”‚  â”‚ é“¾è·¯è¿½è¸ª â”‚  â”‚ ç»Ÿè®¡åˆ†æ â”‚  â”‚
â”‚  â”‚ è·¯ç”±       â”‚  â”‚ ä»¶       â”‚  â”‚ æœåŠ¡     â”‚  â”‚ æœåŠ¡     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ ¸å¿ƒå¤„ç†å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  RabbitMQ      â”‚  â”‚  åŠ¨æ€çº¿ç¨‹æ±    â”‚  â”‚  Redisåˆ†å¸ƒå¼é”  â”‚ â”‚
â”‚  â”‚  æ¶ˆæ¯é˜Ÿåˆ—      â”‚  â”‚  è‡ªåŠ¨ä¼¸ç¼©     â”‚  â”‚  é˜²é‡å¤å¤„ç†     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ•°æ®å­˜å‚¨å±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚ PostgreSQL â”‚  â”‚  Redis   â”‚  â”‚ RabbitMQ â”‚                â”‚
â”‚  â”‚ ä¸šåŠ¡æ•°æ®   â”‚  â”‚  ç¼“å­˜    â”‚  â”‚ æ¶ˆæ¯é˜Ÿåˆ— â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 1. åŠ¨æ€çº¿ç¨‹æ± ï¼ˆthread_pool_service.pyï¼‰

**åŠŸèƒ½**ï¼šè‡ªåŠ¨ä¼¸ç¼©çº¿ç¨‹æ± ï¼Œæ ¹æ®é˜Ÿåˆ—å‹åŠ›åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ•°

**é…ç½®**ï¼š
```python
{
  "message_sender": {
    "core_pool_size": 20,      # æ ¸å¿ƒçº¿ç¨‹æ•°
    "max_pool_size": 100,      # æœ€å¤§çº¿ç¨‹æ•°
    "scale_up_threshold": 0.8,  # æ‰©å®¹é˜ˆå€¼ï¼ˆé˜Ÿåˆ—ä½¿ç”¨ç‡80%ï¼‰
    "scale_down_threshold": 0.2 # ç¼©å®¹é˜ˆå€¼ï¼ˆé˜Ÿåˆ—ä½¿ç”¨ç‡20%ï¼‰
  }
}
```

**ç›‘æ§æŒ‡æ ‡**ï¼š
- `active_count`ï¼šå½“å‰æ´»è·ƒçº¿ç¨‹æ•°
- `queue_size`ï¼šé˜Ÿåˆ—ä¸­ç­‰å¾…ä»»åŠ¡æ•°
- `completed_tasks`ï¼šå·²å®Œæˆä»»åŠ¡æ•°
- `avg_task_duration_ms`ï¼šå¹³å‡ä»»åŠ¡è€—æ—¶

---

### 2. RabbitMQæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆrabbitmq_service.pyï¼‰

**é˜Ÿåˆ—ç±»å‹**ï¼š
1. **message.send**ï¼šæ¶ˆæ¯å‘é€é˜Ÿåˆ—ï¼ˆæ”¯æŒä¼˜å…ˆçº§0-10ï¼‰
2. **ai.process**ï¼šAIå¤„ç†é˜Ÿåˆ—
3. **notification**ï¼šé€šçŸ¥é˜Ÿåˆ—
4. **delayed**ï¼šå»¶è¿Ÿæ¶ˆæ¯é˜Ÿåˆ—

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
# å‘é€é«˜ä¼˜å…ˆçº§æ¶ˆæ¯
rabbitmq_service.publish_message(
    queue="message.send",
    message={"content": "ç´§æ€¥é€šçŸ¥"},
    priority=10  # æœ€é«˜ä¼˜å…ˆçº§
)

# å»¶è¿Ÿ5åˆ†é’Ÿå‘é€
rabbitmq_service.publish_message(
    queue="delayed",
    message={"content": "å®šæ—¶æé†’"},
    delay_ms=300000  # 5åˆ†é’Ÿ
)
```

---

### 3. Redisé“¾è·¯è¿½è¸ªï¼ˆmessage_trace_service.pyï¼‰

**è¿½è¸ªæµç¨‹**ï¼š
```
å¼€å§‹è¿½è¸ª â†’ å…¥é˜Ÿ â†’ å¤„ç† â†’ å‘é€ â†’ å›è°ƒ â†’ å®Œæˆè¿½è¸ª
   â†“        â†“      â†“      â†“      â†“        â†“
 trace   queue  process send callback  finish
```

**æ•°æ®ç»“æ„**ï¼š
```json
{
  "trace_id": "msg_123456",
  "nodes": [
    {
      "name": "queue",
      "start_time": "2024-01-01 10:00:00",
      "finish_time": "2024-01-01 10:00:01",
      "duration_ms": 1000,
      "status": "success"
    }
  ],
  "statistics": {
    "total_duration_ms": 3500,
    "node_count": 4,
    "success_rate": 100.0
  }
}
```

---

### 4. Sentinelé™æµï¼ˆsentinel_service.pyï¼‰

**é™æµç­–ç•¥**ï¼š
1. **QPSé™æµ**ï¼šæ¯ç§’è¯·æ±‚æ•°é™åˆ¶
2. **å¹¶å‘é™æµ**ï¼šåŒæ—¶å¤„ç†çš„è¯·æ±‚æ•°é™åˆ¶
3. **æ»‘åŠ¨çª—å£**ï¼šæ—¶é—´çª—å£å†…è¯·æ±‚æ€»æ•°é™åˆ¶

**é…ç½®ç¤ºä¾‹**ï¼š
```python
# QPSé™æµï¼ˆæ¯ç§’æœ€å¤š100ä¸ªè¯·æ±‚ï¼‰
qps_limiter = QPSRateLimiter(redis_client, max_qps=100)

# å¹¶å‘é™æµï¼ˆæœ€å¤š50ä¸ªå¹¶å‘ï¼‰
concurrent_limiter = ConcurrentLimiter(redis_client, max_concurrent=50)

# æ»‘åŠ¨çª—å£é™æµï¼ˆ60ç§’å†…æœ€å¤š1000ä¸ªè¯·æ±‚ï¼‰
sliding_limiter = SlidingWindowLimiter(
    redis_client, 
    max_requests=1000, 
    window_seconds=60
)
```

**è£…é¥°å™¨ç”¨æ³•**ï¼š
```python
@router.post("/api/send-message")
@rate_limit(resource="api:/send_message", max_qps=1000)
async def send_message():
    # è‡ªåŠ¨è¿›è¡Œé™æµæ£€æŸ¥
    pass
```

---

### 5. Redissonåˆ†å¸ƒå¼é”ï¼ˆredis_lock_service.pyï¼‰

**é”ç±»å‹**ï¼š
1. **ç®€å•é”**ï¼šæ™®é€šäº’æ–¥é”
2. **å¯é‡å…¥é”**ï¼šåŒä¸€çº¿ç¨‹å¯å¤šæ¬¡è·å–

**ä½¿ç”¨åœºæ™¯**ï¼š
- é˜²æ­¢æ‰¹é‡ä»»åŠ¡é‡å¤æäº¤
- é¿å…å¹¶å‘æ›´æ–°å†²çª
- åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„äº’æ–¥æ“ä½œ

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
# æ–¹å¼1ï¼šwithè¯­å¥
with distributed_lock(redis_client, "batch_task:123"):
    # ä¸´ç•ŒåŒºä»£ç 
    create_batch_task()

# æ–¹å¼2ï¼šæ‰‹åŠ¨ç®¡ç†
lock = RedisDistributedLock(redis_client, "resource_name")
if lock.acquire():
    try:
        process_critical_section()
    finally:
        lock.release()
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# åç«¯ä¾èµ–
cd backend
pip install fastapi sqlalchemy asyncpg redis pika

# å‰ç«¯ä¾èµ–
cd ../frontend
npm install echarts
```

### 2. åˆå§‹åŒ–æ•°æ®åº“

```bash
# æ‰§è¡Œæ•°æ®åº“è¿ç§»
psql -U postgres -d customer_system -f backend/messaging_extension.sql
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š
```ini
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://user:password@localhost/customer_system

# Redisé…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0

# RabbitMQé…ç½®
RABBITMQ_HOST=localhost
RABBITMQ_PORT=5672
RABBITMQ_USER=guest
RABBITMQ_PASSWORD=guest
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨åç«¯
cd backend
uvicorn app.main:app --reload --port 8000

# å¯åŠ¨å‰ç«¯
cd ../frontend
npm run dev
```

### 5. è®¿é—®ç›‘æ§å¤§å±

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:5173/monitor

---

## ğŸ“Š æ ¸å¿ƒAPIæ¥å£

### æ¶ˆæ¯æ¨¡æ¿ç®¡ç†

#### 1. è·å–æ¨¡æ¿åˆ—è¡¨
```http
GET /api/messages/templates?channel=sms&status=active
```

**å“åº”**ï¼š
```json
{
  "code": 0,
  "data": [
    {
      "id": 1,
      "name": "è®¢å•å‘è´§é€šçŸ¥",
      "channel": "sms",
      "subject": "",
      "content": "æ‚¨çš„è®¢å•{{order_no}}å·²å‘è´§...",
      "variables": ["order_no", "express_no"],
      "status": "active"
    }
  ]
}
```

#### 2. åˆ›å»ºæ¨¡æ¿
```http
POST /api/messages/templates
Content-Type: application/json

{
  "name": "ä¿ƒé”€æ´»åŠ¨",
  "channel": "email",
  "subject": "é™æ—¶ä¼˜æƒ ",
  "content": "{{customer_name}}ï¼Œ{{product_name}}é™æ—¶{{discount}}æŠ˜ï¼",
  "variables": ["customer_name", "product_name", "discount"]
}
```

---

### æ¶ˆæ¯å‘é€

#### 3. å‘é€å•æ¡æ¶ˆæ¯
```http
POST /api/messages/send
Content-Type: application/json

{
  "template_id": 1,
  "recipient": "13800138000",
  "variables": {
    "order_no": "202401010001",
    "express_no": "SF1234567890"
  },
  "priority": 8
}
```

**å“åº”**ï¼š
```json
{
  "code": 0,
  "message": "æ¶ˆæ¯å·²åŠ å…¥å‘é€é˜Ÿåˆ—",
  "data": {
    "record_id": 12345,
    "trace_id": "msg_abc123"
  }
}
```

#### 4. æ‰¹é‡å‘é€æ¶ˆæ¯
```http
POST /api/messages/send-batch
Content-Type: application/json

{
  "template_id": 2,
  "recipients": ["user1@example.com", "user2@example.com"],
  "variables_list": [
    {"customer_name": "å¼ ä¸‰", "discount": "8"},
    {"customer_name": "æå››", "discount": "7"}
  ],
  "priority": 5
}
```

---

### é“¾è·¯è¿½è¸ª

#### 5. è·å–æ¶ˆæ¯è¿½è¸ª
```http
GET /api/messages/traces/msg_abc123
```

**å“åº”**ï¼š
```json
{
  "code": 0,
  "data": {
    "trace_id": "msg_abc123",
    "trace_data": {
      "nodes": [
        {"name": "queue", "duration_ms": 50, "status": "success"},
        {"name": "process", "duration_ms": 120, "status": "success"},
        {"name": "send", "duration_ms": 850, "status": "success"}
      ]
    },
    "statistics": {
      "total_duration_ms": 1020,
      "success_rate": 100.0
    }
  }
}
```

---

### ç»Ÿè®¡åˆ†æ

#### 6. è·å–ç»Ÿè®¡æ¦‚è§ˆ
```http
GET /api/messages/statistics/overview?start_date=2024-01-01&end_date=2024-01-07
```

**å“åº”**ï¼š
```json
{
  "code": 0,
  "data": {
    "overview": {
      "total_sent": 150000,
      "total_success": 147500,
      "total_failed": 2500,
      "success_rate": 98.33,
      "avg_response_time": 850
    },
    "by_channel": {
      "sms": {"sent": 80000, "success": 79200, "failed": 800},
      "email": {"sent": 50000, "success": 49000, "failed": 1000}
    }
  }
}
```

#### 7. è·å–å®æ—¶ç»Ÿè®¡
```http
GET /api/messages/statistics/realtime
```

**å“åº”**ï¼š
```json
{
  "code": 0,
  "data": {
    "message_stats": [
      {"status": "success", "channel": "sms", "count": 1250, "avg_duration_seconds": 0.85}
    ],
    "thread_pool_stats": {
      "message_sender": {
        "active_count": 45,
        "queue_size": 120,
        "queue_usage_percent": 6.0
      }
    }
  }
}
```

---

## ğŸ¨ å‰ç«¯ç›‘æ§ç•Œé¢

### åŠŸèƒ½ç‰¹æ€§

1. **å®æ—¶æ•°æ®å¡ç‰‡**
   - ä»Šæ—¥å‘é€æ€»æ•°
   - å‘é€æˆåŠŸç‡
   - å¹³å‡å“åº”æ—¶é—´
   - å‘é€å¤±è´¥æ•°

2. **å¯è§†åŒ–å›¾è¡¨**
   - ğŸ“ˆ å‘é€è¶‹åŠ¿æŠ˜çº¿å›¾ï¼ˆ7å¤©æ•°æ®ï¼‰
   - ğŸ¯ æ¸ é“åˆ†å¸ƒé¥¼å›¾
   - ğŸ“Š æˆåŠŸç‡å¯¹æ¯”æŸ±çŠ¶å›¾
   - âš™ï¸ çº¿ç¨‹æ± ä½¿ç”¨ç‡ä»ªè¡¨ç›˜

3. **å®æ—¶æ¶ˆæ¯æµ**
   - æœ€è¿‘50æ¡æ¶ˆæ¯è®°å½•
   - çŠ¶æ€å®æ—¶æ›´æ–°
   - è€—æ—¶ç»Ÿè®¡

4. **è‡ªåŠ¨åˆ·æ–°**
   - æ¯5ç§’è‡ªåŠ¨åˆ·æ–°æ•°æ®
   - æ”¯æŒæš‚åœ/æ¢å¤

### ç•Œé¢æˆªå›¾å‚è€ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š æ¶ˆæ¯å¤„ç†ç›‘æ§å¤§å±                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ“§ 150,000]  [âœ… 98.33%]  [âš¡ 850ms]  [âš ï¸ 2,500]       â”‚
â”‚  ä»Šæ—¥å‘é€æ€»æ•°   å‘é€æˆåŠŸç‡   å¹³å‡å“åº”     å‘é€å¤±è´¥æ•°      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ˆ å„æ—¶æ®µå‘é€æƒ…å†µ     â”‚  ğŸ¯ å„æ¸ é“å‘é€å æ¯”                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                  â”‚ â”‚  â”‚     çŸ­ä¿¡ 53%             â”‚    â”‚
â”‚  â”‚  /\  /\          â”‚ â”‚  â”‚     é‚®ç®± 33%             â”‚    â”‚
â”‚  â”‚ /  \/  \  /\     â”‚ â”‚  â”‚     APP  10%             â”‚    â”‚
â”‚  â”‚         \/  \    â”‚ â”‚  â”‚     å¾®ä¿¡  4%             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Š å„æ¸ é“æˆåŠŸç‡å¯¹æ¯”   â”‚  âš™ï¸ çº¿ç¨‹æ± å®æ—¶çŠ¶æ€               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ [â–ˆâ–ˆâ–ˆâ–ˆ] 99%       â”‚ â”‚  â”‚        45%               â”‚    â”‚
â”‚  â”‚ [â–ˆâ–ˆâ–ˆâ–ˆ] 98%       â”‚ â”‚  â”‚    â•±â”€â”€â”€â”€â”€â”€â”€â•²            â”‚    â”‚
â”‚  â”‚ [â–ˆâ–ˆâ–ˆ ] 97%       â”‚ â”‚  â”‚   â”‚   45%   â”‚           â”‚    â”‚
â”‚  â”‚ [â–ˆâ–ˆ  ] 95%       â”‚ â”‚  â”‚    â•²â”€â”€â”€â”€â”€â”€â”€â•±            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ è¿ç»´æŒ‡å—

### æ€§èƒ½è°ƒä¼˜

#### 1. çº¿ç¨‹æ± é…ç½®
æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è°ƒæ•´ï¼š
```sql
-- é«˜æ€§èƒ½æœåŠ¡å™¨ï¼ˆ16æ ¸å¿ƒï¼‰
UPDATE thread_pool_configs 
SET core_pool_size = 50, max_pool_size = 200 
WHERE pool_name = 'message_sender';

-- ä½æ€§èƒ½æœåŠ¡å™¨ï¼ˆ4æ ¸å¿ƒï¼‰
UPDATE thread_pool_configs 
SET core_pool_size = 10, max_pool_size = 50 
WHERE pool_name = 'message_sender';
```

#### 2. é™æµè§„åˆ™
æ ¹æ®ä¸šåŠ¡éœ€æ±‚è°ƒæ•´ï¼š
```sql
-- ä¿ƒé”€æ´»åŠ¨æœŸé—´æé«˜QPS
UPDATE rate_limit_configs 
SET max_value = 2000 
WHERE resource = 'api:/messages/send' AND limit_type = 'qps';

-- æ¢å¤æ­£å¸¸
UPDATE rate_limit_configs 
SET max_value = 1000 
WHERE resource = 'api:/messages/send' AND limit_type = 'qps';
```

---

### ç›‘æ§å‘Šè­¦

#### å…³é”®æŒ‡æ ‡

1. **æ¶ˆæ¯å‘é€æˆåŠŸç‡**
   - å‘Šè­¦é˜ˆå€¼ï¼š< 95%
   - æ£€æŸ¥å‘¨æœŸï¼š5åˆ†é’Ÿ

2. **å¹³å‡å“åº”æ—¶é—´**
   - å‘Šè­¦é˜ˆå€¼ï¼š> 2000ms
   - æ£€æŸ¥å‘¨æœŸï¼š1åˆ†é’Ÿ

3. **çº¿ç¨‹æ± ä½¿ç”¨ç‡**
   - å‘Šè­¦é˜ˆå€¼ï¼š> 90%
   - æ£€æŸ¥å‘¨æœŸï¼š30ç§’

4. **é˜Ÿåˆ—ç§¯å‹**
   - å‘Šè­¦é˜ˆå€¼ï¼š> 5000æ¡
   - æ£€æŸ¥å‘¨æœŸï¼š1åˆ†é’Ÿ

---

### æ•…éšœæ’æŸ¥

#### é—®é¢˜1ï¼šæ¶ˆæ¯å‘é€å¤±è´¥ç‡é«˜

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æŸ¥çœ‹é”™è¯¯æ—¥å¿—
```sql
SELECT error_message, COUNT(*) 
FROM message_records 
WHERE status = 'failed' AND created_at > NOW() - INTERVAL '1 hour'
GROUP BY error_message;
```

2. æ£€æŸ¥æ¸ é“æœåŠ¡çŠ¶æ€
3. æŸ¥çœ‹é™æµé…ç½®æ˜¯å¦è¿‡ä¸¥
4. æ£€æŸ¥ç½‘ç»œè¿æ¥

#### é—®é¢˜2ï¼šç³»ç»Ÿå“åº”æ…¢

**æ’æŸ¥æ­¥éª¤**ï¼š
1. æŸ¥çœ‹çº¿ç¨‹æ± çŠ¶æ€
```http
GET /api/messages/statistics/realtime
```

2. æ£€æŸ¥é˜Ÿåˆ—ç§¯å‹æƒ…å†µ
3. æŸ¥çœ‹æ•°æ®åº“æ…¢æŸ¥è¯¢
4. æ£€æŸ¥Redisè¿æ¥

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. æ¶ˆæ¯ä¼˜å…ˆçº§è®¾ç½®

```python
# ç´§æ€¥æ¶ˆæ¯ï¼ˆç³»ç»Ÿæ•…éšœé€šçŸ¥ï¼‰ï¼šä¼˜å…ˆçº§ 10
priority = 10

# é‡è¦æ¶ˆæ¯ï¼ˆè®¢å•å‘è´§ï¼‰ï¼šä¼˜å…ˆçº§ 7-8
priority = 8

# æ™®é€šæ¶ˆæ¯ï¼ˆè¥é”€æ´»åŠ¨ï¼‰ï¼šä¼˜å…ˆçº§ 5
priority = 5

# ä½ä¼˜å…ˆçº§ï¼ˆæ—¥æŠ¥ï¼‰ï¼šä¼˜å…ˆçº§ 1-2
priority = 2
```

### 2. æ‰¹é‡å‘é€å»ºè®®

```python
# å•æ¬¡æ‰¹é‡ä¸è¶…è¿‡10000æ¡
if len(recipients) > 10000:
    # åˆ†æ‰¹å¤„ç†
    for batch in chunks(recipients, 10000):
        send_batch_messages(batch)
```

### 3. æ¨¡æ¿å˜é‡å‘½å

```python
# âœ… æ¨èï¼šæ¸…æ™°çš„å˜é‡å
variables = {
    "customer_name": "å¼ ä¸‰",
    "order_no": "202401010001",
    "delivery_date": "2024-01-05"
}

# âŒ ä¸æ¨èï¼šæ¨¡ç³Šçš„å˜é‡å
variables = {
    "name": "å¼ ä¸‰",
    "no": "202401010001",
    "date": "2024-01-05"
}
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è®¡åˆ’

- [ ] é›†æˆNacosåŠ¨æ€é…ç½®
- [ ] é›†æˆXxl-jobå®šæ—¶ä»»åŠ¡
- [ ] WebSocketå®æ—¶æ¨é€
- [ ] æ¶ˆæ¯æ¨¡æ¿å¯è§†åŒ–ç¼–è¾‘å™¨
- [ ] A/Bæµ‹è¯•æ”¯æŒ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- ğŸ“– [APIæ–‡æ¡£](http://localhost:8000/docs)
- ğŸ” [ç›‘æ§å¤§å±](http://localhost:5173/monitor)
- ğŸ’¬ æŠ€æœ¯è®¨è®ºç¾¤

---

**ç‰ˆæœ¬**ï¼šv1.0.0  
**æ›´æ–°æ—¶é—´**ï¼š2024-01-01  
**ä½œè€…**ï¼šå¼€å‘å›¢é˜Ÿ
