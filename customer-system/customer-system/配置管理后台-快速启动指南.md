# ğŸš€ é…ç½®ç®¡ç†åå° - å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸ“‹ å‰ç½®æ¡ä»¶

åœ¨å¼€å§‹ä¹‹å‰,è¯·ç¡®ä¿æ‚¨å·²å®‰è£…:
- âœ… Python 3.9+
- âœ… Node.js 16+
- âœ… PostgreSQL 13+
- âœ… Redis 6+

## âš¡ 5åˆ†é’Ÿå¿«é€Ÿå¯åŠ¨

### æ­¥éª¤1: å®‰è£…Pythonä¾èµ–

```bash
cd customer-system/backend
pip install -r requirements.txt
```

æ–°å¢çš„ä¾èµ–åŒ…æ‹¬:
- `passlib` - å¯†ç åŠ å¯†
- `bcrypt` - å¯†ç å“ˆå¸Œ
- `asyncpg` - å¼‚æ­¥PostgreSQLé©±åŠ¨

### æ­¥éª¤2: åˆå§‹åŒ–æ•°æ®åº“

```bash
# è¿æ¥åˆ°PostgreSQL
psql -U postgres -d customer_system

# æ‰§è¡Œé…ç½®ç®¡ç†æ‰©å±•è„šæœ¬
\i config_management_extension.sql

# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ
psql -U postgres -d customer_system -f config_management_extension.sql
```

è¿™å°†åˆ›å»º:
- 8ä¸ªæ–°æ•°æ®è¡¨(roles, admin_users, permissionsç­‰)
- 6ä¸ªé¢„åˆ¶è§’è‰²
- 23ä¸ªæƒé™é¡¹
- 6ä¸ªé…ç½®åˆ†ç»„
- é»˜è®¤é…ç½®é¡¹
- 3ä¸ªä¸šåŠ¡æµç¨‹æ¨¡æ¿
- 1ä¸ªé»˜è®¤ç®¡ç†å‘˜è´¦å·

### æ­¥éª¤3: å¯åŠ¨åç«¯æœåŠ¡

```bash
cd customer-system/backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

æ£€æŸ¥æœåŠ¡çŠ¶æ€:
```bash
curl http://localhost:8000/health
# åº”è¿”å›: {"status": "healthy"}
```

### æ­¥éª¤4: å®‰è£…å‰ç«¯ä¾èµ–

```bash
cd customer-system/frontend
npm install
```

ç¡®ä¿package.jsonåŒ…å«:
```json
{
  "dependencies": {
    "vue": "^3.3.4",
    "element-plus": "^2.4.4",
    "axios": "^1.6.2",
    "vue-router": "^4.2.5"
  }
}
```

### æ­¥éª¤5: å¯åŠ¨å‰ç«¯æœåŠ¡

```bash
npm run dev
```

å‰ç«¯å°†è¿è¡Œåœ¨: http://localhost:5173

### æ­¥éª¤6: è®¿é—®é…ç½®ä¸­å¿ƒ

æ‰“å¼€æµè§ˆå™¨,è®¿é—®:
```
http://localhost:5173/config
```

ä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•:
- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `admin123`

âš ï¸ **é‡è¦**: ç™»å½•åè¯·ç«‹å³ä¿®æ”¹é»˜è®¤å¯†ç !

## ğŸ¯ å¿«é€Ÿé…ç½®æŒ‡å—

### ç¬¬ä¸€æ¬¡é…ç½®ï¼ˆ3æ­¥å®Œæˆï¼‰

#### 1. ä¼ä¸šå¾®ä¿¡é…ç½®

è¿›å…¥"é…ç½®æ¦‚è§ˆ" â†’ "ä¼ä¸šå¾®ä¿¡é…ç½®"

```
ä¼ä¸šå¾®ä¿¡CorpID: [å¡«å†™æ‚¨çš„ä¼ä¸šID]
ä¼ä¸šå¾®ä¿¡åº”ç”¨Secret: [å¡«å†™åº”ç”¨å¯†é’¥]
åº”ç”¨AgentId: [å¡«å†™AgentId]
```

ğŸ’¡ å¦‚ä½•è·å–:
- ç™»å½•[ä¼ä¸šå¾®ä¿¡ç®¡ç†åå°](https://work.weixin.qq.com)
- åº”ç”¨ç®¡ç† â†’ é€‰æ‹©åº”ç”¨ â†’ æŸ¥çœ‹è¯¦æƒ…

#### 2. æ¶ˆæ¯æ¥æ”¶é…ç½®

```
Token: [è‡ªå®šä¹‰16ä½å­—ç¬¦ä¸²]
EncodingAESKey: [è‡ªå®šä¹‰43ä½å­—ç¬¦ä¸²]
â˜‘ï¸ å¯ç”¨æ¶ˆæ¯æ¥æ”¶
```

å¤åˆ¶è‡ªåŠ¨ç”Ÿæˆçš„å›è°ƒURL,é…ç½®åˆ°ä¼ä¸šå¾®ä¿¡åå°ã€‚

#### 3. ç¾¤æœºå™¨äººé…ç½®

ç‚¹å‡»"ç¾¤æœºå™¨äºº" â†’ "æ·»åŠ Webhook"

```
Webhookåç§°: æ–°å®¢æˆ·é€šçŸ¥ç¾¤
Webhookç±»å‹: æ–°å®¢æˆ·é€šçŸ¥
Webhook URL: [ä»ä¼ä¸šå¾®ä¿¡ç¾¤è·å–]
```

ğŸ’¡ å¦‚ä½•è·å–Webhook:
- ä¼ä¸šå¾®ä¿¡ç¾¤ â†’ ç¾¤è®¾ç½® â†’ ç¾¤æœºå™¨äºº â†’ æ·»åŠ æœºå™¨äºº â†’ å¤åˆ¶Webhookåœ°å€

## ğŸ“Š APIæ–‡æ¡£

å¯åŠ¨åè®¿é—®è‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£:
```
http://localhost:8000/docs
```

æ–°å¢çš„APIç«¯ç‚¹:
```
GET  /api/admin/config-center/overview        # è·å–é…ç½®æ¦‚è§ˆ
POST /api/admin/config-center/batch-update    # æ‰¹é‡æ›´æ–°é…ç½®
GET  /api/admin/config-center/webhooks        # è·å–Webhookåˆ—è¡¨
POST /api/admin/config-center/webhooks        # åˆ›å»ºWebhook
GET  /api/admin/config-center/workflows       # è·å–ä¸šåŠ¡æµç¨‹æ¨¡æ¿
POST /api/admin/config-center/workflows/activate/{code}  # æ¿€æ´»æµç¨‹
GET  /api/admin/config-center/roles           # è·å–è§’è‰²åˆ—è¡¨
GET  /api/admin/config-center/permissions     # è·å–æƒé™åˆ—è¡¨
GET  /api/admin/config-center/users           # è·å–ç”¨æˆ·åˆ—è¡¨
POST /api/admin/config-center/users           # åˆ›å»ºç”¨æˆ·
GET  /api/admin/config-center/logs            # è·å–æ“ä½œæ—¥å¿—
```

## ğŸ§ª æµ‹è¯•é…ç½®

### æµ‹è¯•ä¼ä¸šå¾®ä¿¡é…ç½®

```bash
curl -X GET "http://localhost:8000/api/admin/config-center/overview"
```

åº”è¿”å›é…ç½®åˆ†ç»„åˆ—è¡¨ã€‚

### æµ‹è¯•åˆ›å»ºç”¨æˆ·

```bash
curl -X POST "http://localhost:8000/api/admin/config-center/users" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "test_user",
    "password": "password123",
    "real_name": "æµ‹è¯•ç”¨æˆ·",
    "email": "test@example.com",
    "role_id": 3
  }'
```

### æµ‹è¯•æ¿€æ´»ä¸šåŠ¡æµç¨‹

```bash
curl -X POST "http://localhost:8000/api/admin/config-center/workflows/activate/standard_presale"
```

## ğŸ”§ é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶:

```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://postgres:password@localhost:5432/customer_system

# Redisé…ç½®
REDIS_URL=redis://localhost:6379/0

# ä¼ä¸šå¾®ä¿¡é…ç½®(å¯é€‰,ä¹Ÿå¯åœ¨ç½‘é¡µé…ç½®)
WEWORK_CORP_ID=
WEWORK_APP_SECRET=
WEWORK_AGENT_ID=

# JWTå¯†é’¥(ç”¨äºè®¤è¯)
JWT_SECRET_KEY=your-secret-key-change-this

# APIåŸºç¡€URL
API_BASE_URL=http://localhost:8000
```

## ğŸ“ æ•°æ®åº“è¡¨ç»“æ„

é…ç½®ç®¡ç†ç›¸å…³è¡¨:

```sql
roles                     -- è§’è‰²è¡¨
admin_users              -- ç®¡ç†å‘˜ç”¨æˆ·è¡¨
permissions              -- æƒé™è¡¨
config_groups            -- é…ç½®åˆ†ç»„è¡¨
enhanced_system_config   -- å¢å¼ºç³»ç»Ÿé…ç½®è¡¨
workflow_templates       -- ä¸šåŠ¡æµç¨‹æ¨¡æ¿è¡¨
robot_webhooks           -- ç¾¤æœºå™¨äººé…ç½®è¡¨
operation_logs           -- æ“ä½œæ—¥å¿—è¡¨
```

æŸ¥çœ‹å·²åˆ›å»ºçš„è¡¨:
```sql
\dt
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

**é—®é¢˜**: `Connection refused`

**è§£å†³**:
```bash
# æ£€æŸ¥PostgreSQLæ˜¯å¦è¿è¡Œ
pg_ctl status

# æ£€æŸ¥è¿æ¥å‚æ•°
psql -U postgres -d customer_system -c "SELECT 1"
```

### 2. å‰ç«¯æ— æ³•è¿æ¥åç«¯

**é—®é¢˜**: CORSé”™è¯¯

**è§£å†³**: æ£€æŸ¥[main.py](backend/app/main.py)çš„CORSé…ç½®:
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],  # æ·»åŠ å‰ç«¯åœ°å€
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

### 3. å¯†ç åŠ å¯†å¤±è´¥

**é—®é¢˜**: `bcrypt` æ¨¡å—æœªå®‰è£…

**è§£å†³**:
```bash
pip install bcrypt passlib
```

### 4. Redisè¿æ¥å¤±è´¥

**é—®é¢˜**: ç¼“å­˜åŠŸèƒ½ä¸å¯ç”¨

**è§£å†³**:
```bash
# å¯åŠ¨Redis
redis-server

# æ£€æŸ¥è¿æ¥
redis-cli ping
# åº”è¿”å›: PONG
```

### 5. å‰ç«¯ç»„ä»¶æ— æ³•æ˜¾ç¤º

**é—®é¢˜**: Element Plusæ ·å¼ä¸¢å¤±

**è§£å†³**: ç¡®ä¿[main.js](frontend/src/main.js)æ­£ç¡®å¯¼å…¥:
```javascript
import ElementPlus from 'element-plus'
import 'element-plus/dist/index.css'

app.use(ElementPlus)
```

## ğŸ“š ä¸‹ä¸€æ­¥

é…ç½®å®Œæˆå,å»ºè®®:

1. **ä¿®æ”¹é»˜è®¤å¯†ç **
   - ç”¨æˆ·ç®¡ç† â†’ ç¼–è¾‘adminç”¨æˆ· â†’ ä¿®æ”¹å¯†ç 

2. **åˆ›å»ºå…¶ä»–ç”¨æˆ·**
   - ä¸ºé”€å”®ã€å®¢æœã€å·¥ç¨‹å¸ˆåˆ›å»ºè´¦å·
   - åˆ†é…å¯¹åº”è§’è‰²

3. **é…ç½®Webhook**
   - è‡³å°‘é…ç½®ä¸€ä¸ªæ–°å®¢æˆ·é€šçŸ¥ç¾¤

4. **é€‰æ‹©ä¸šåŠ¡æµç¨‹**
   - è¿›å…¥"ä¸šåŠ¡æµç¨‹"é¡µé¢
   - é€‰æ‹©é€‚åˆæ‚¨çš„æµç¨‹æ¨¡æ¿

5. **æµ‹è¯•æ¶ˆæ¯æ¥æ”¶**
   - åœ¨ä¼ä¸šå¾®ä¿¡å‘é€æµ‹è¯•æ¶ˆæ¯
   - æ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å“åº”

## ğŸ“ å­¦ä¹ èµ„æº

- [å®Œæ•´ä½¿ç”¨æŒ‡å—](ç½‘é¡µé…ç½®ç®¡ç†åå°-ä½¿ç”¨æŒ‡å—.md)
- [æŠ€æœ¯æ¶æ„å›¾](é…ç½®ç®¡ç†ç³»ç»Ÿ-æŠ€æœ¯æ¶æ„å›¾.md)
- [åŠŸèƒ½å¯¹æ¯”åˆ†æ](åŠŸèƒ½å¯¹æ¯”-æœ¬é¡¹ç›®vså¼€æºé¡¹ç›®.md)
- [APIæ–‡æ¡£](http://localhost:8000/docs)

## ğŸ’¬ è·å–å¸®åŠ©

å¦‚é‡é—®é¢˜:

1. æŸ¥çœ‹æ“ä½œæ—¥å¿—(é…ç½®ä¸­å¿ƒ â†’ æ“ä½œæ—¥å¿—)
2. æ£€æŸ¥åç«¯æ§åˆ¶å°è¾“å‡º
3. æŸ¥çœ‹[å®Œæ•´ä½¿ç”¨æŒ‡å—](ç½‘é¡µé…ç½®ç®¡ç†åå°-ä½¿ç”¨æŒ‡å—.md)

## âœ… éªŒæ”¶æ¸…å•

å®Œæˆä»¥ä¸‹æ£€æŸ¥,ç¡®è®¤ç³»ç»Ÿæ­£å¸¸è¿è¡Œ:

- [ ] åç«¯æœåŠ¡å¯åŠ¨æˆåŠŸ(`/health` è¿”å›healthy)
- [ ] å‰ç«¯ç•Œé¢å¯è®¿é—®(`http://localhost:5173`)
- [ ] å¯ä»¥ç™»å½•é…ç½®ä¸­å¿ƒ
- [ ] é…ç½®æ¦‚è§ˆæ˜¾ç¤ºæ‰€æœ‰åˆ†ç»„
- [ ] å¯ä»¥ä¿å­˜é…ç½®
- [ ] å¯ä»¥åˆ›å»ºWebhook
- [ ] å¯ä»¥åˆ‡æ¢ä¸šåŠ¡æµç¨‹
- [ ] å¯ä»¥åˆ›å»ºç”¨æˆ·
- [ ] æ“ä½œæ—¥å¿—æ­£å¸¸è®°å½•

---

**æ­å–œï¼ğŸ‰ æ‚¨å·²æˆåŠŸå¯åŠ¨é…ç½®ç®¡ç†åå°ï¼**

ç°åœ¨æ‚¨å¯ä»¥:
- âœ… é›¶ä»£ç é…ç½®æ‰€æœ‰å‚æ•°
- âœ… ç®¡ç†ç”¨æˆ·å’Œæƒé™
- âœ… åˆ‡æ¢ä¸šåŠ¡æµç¨‹
- âœ… æŸ¥çœ‹æ“ä½œæ—¥å¿—

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼**
