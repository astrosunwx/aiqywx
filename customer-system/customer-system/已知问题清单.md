# ğŸ› å·²çŸ¥é—®é¢˜æ¸…å•ä¸å¿«é€Ÿç´¢å¼•

**æœ€åæ›´æ–°**: 2026å¹´2æœˆ3æ—¥  
**é¡¹ç›®**: æ™ºèƒ½å”®å‰å”®åç³»ç»Ÿ  
**ä»“åº“**: astrosunwx/aiqywx

---

## ğŸ“‹ é—®é¢˜åˆ†ç±»å¿«é€Ÿç´¢å¼•

| ç±»åˆ« | ç´§æ€¥ç¨‹åº¦ | é—®é¢˜æ•° | è·³è½¬ |
|------|---------|-------|------|
| ğŸ”´ åç«¯APIé”™è¯¯ | é«˜ | 2ä¸ª | [æŸ¥çœ‹](#åç«¯apié”™è¯¯) |
| ğŸŸ¡ ç¼ºå¤±åŠŸèƒ½ | ä¸­ | 8ä¸ª | [æŸ¥çœ‹](#ç¼ºå¤±çš„apiåŠŸèƒ½) |
| ğŸŸ¢ å·²ä¿®å¤ | - | 6ä¸ª | [æŸ¥çœ‹](#å·²ä¿®å¤é—®é¢˜å†å²) |
| ğŸ“ ä¼˜åŒ–å»ºè®® | ä½ | 3ä¸ª | [æŸ¥çœ‹](#ä¼˜åŒ–å»ºè®®) |

---

## ğŸ”´ åç«¯APIé”™è¯¯

### 1. è§’è‰²ç®¡ç†APIè¿”å›500é”™è¯¯
**æ–‡ä»¶ä½ç½®**: `backend/app/routers/config_center.py`  
**APIç«¯ç‚¹**: `GET /api/admin/config-center/roles`  
**é”™è¯¯ç±»å‹**: Internal Server Error  
**å½±å“èŒƒå›´**: é…ç½®ä¸­å¿ƒ - è§’è‰²ç®¡ç†é¡µé¢æ— æ³•ä½¿ç”¨  
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**é—®é¢˜æè¿°**:
```
GET http://localhost:8001/api/admin/config-center/roles
è¿”å›: 500 Internal Server Error
```

**å¯èƒ½åŸå› **:
- [ ] æ•°æ®åº“è¡¨ `roles` æˆ– `permissions` ä¸å­˜åœ¨
- [ ] SQLAlchemyæ¨¡å‹å®šä¹‰é”™è¯¯
- [ ] æŸ¥è¯¢è¯­å¥æœ‰bug
- [ ] å¼‚æ­¥æ•°æ®åº“ä¼šè¯é—®é¢˜

**æ’æŸ¥æ­¥éª¤**:
1. æŸ¥çœ‹åç«¯æ—¥å¿—: `cat backend/server.log | Select-String "ERROR"`
2. æ£€æŸ¥æ•°æ®åº“è¡¨: `sqlite3 customer_system.db ".tables"`
3. éªŒè¯æ¨¡å‹å®šä¹‰: æ£€æŸ¥ `app/models_config.py` ä¸­çš„ Role æ¨¡å‹
4. æµ‹è¯•SQLæŸ¥è¯¢: ç›´æ¥åœ¨æ•°æ®åº“ä¸­æ‰§è¡ŒæŸ¥è¯¢

**ç›¸å…³æ–‡ä»¶**:
- `backend/app/routers/config_center.py` (lines 185-210)
- `backend/app/models_config.py`
- `backend/customer_system.db`

---

### 2. ç”¨æˆ·ç®¡ç†APIè¿”å›500é”™è¯¯
**æ–‡ä»¶ä½ç½®**: `backend/app/routers/config_center.py`  
**APIç«¯ç‚¹**: `GET /api/admin/config-center/users`  
**é”™è¯¯ç±»å‹**: Internal Server Error  
**å½±å“èŒƒå›´**: é…ç½®ä¸­å¿ƒ - ç”¨æˆ·ç®¡ç†é¡µé¢æ— æ³•ä½¿ç”¨  
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

**é—®é¢˜æè¿°**:
```
GET http://localhost:8001/api/admin/config-center/users
è¿”å›: 500 Internal Server Error
```

**å¯èƒ½åŸå› **:
- [ ] æ•°æ®åº“è¡¨ `admin_users` ä¸å­˜åœ¨
- [ ] å…³è”æŸ¥è¯¢ï¼ˆroleè¡¨ï¼‰é”™è¯¯
- [ ] æ•°æ®ç±»å‹è½¬æ¢é—®é¢˜

**æ’æŸ¥æ­¥éª¤**:
1. åŒä¸Šï¼ˆè§’è‰²ç®¡ç†APIçš„æ’æŸ¥æ­¥éª¤ï¼‰
2. ç‰¹åˆ«æ£€æŸ¥ Role å¤–é”®å…³è”

**ç›¸å…³æ–‡ä»¶**:
- `backend/app/routers/config_center.py`
- `backend/app/models_config.py`

---

## ğŸŸ¡ ç¼ºå¤±çš„APIåŠŸèƒ½

### 3. å®¢æˆ·åˆ—è¡¨APIæœªå®ç°
**éœ€è¦å®ç°**: `GET /api/customers`  
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
**å½±å“åŠŸèƒ½**: æµ‹è¯•å‘é€ - é€‰æ‹©å®¢æˆ·åŠŸèƒ½  
**é¢„æœŸè¿”å›**:
```json
[
  {
    "id": 1,
    "name": "å¼ ä¸‰",
    "phone": "13800138000",
    "company": "XXç§‘æŠ€æœ‰é™å…¬å¸"
  }
]
```

**å®ç°ä½ç½®å»ºè®®**: `backend/app/routers/customer.py`  
**ä¸´æ—¶æ–¹æ¡ˆ**: âœ… å‰ç«¯å·²å®ç°ç¤ºä¾‹æ•°æ®é™çº§

---

### 4. ä¼ä¸šå¾®ä¿¡å‘˜å·¥åˆ—è¡¨APIæœªå®ç°
**éœ€è¦å®ç°**: `GET /api/wechat/work/users`  
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
**å½±å“åŠŸèƒ½**: æµ‹è¯•å‘é€ - é€‰æ‹©ä¼ä¸šå¾®ä¿¡å‘˜å·¥  
**é¢„æœŸè¿”å›**:
```json
[
  {
    "userid": "zhangsan",
    "name": "å¼ ä¸‰",
    "department_name": "æŠ€æœ¯éƒ¨",
    "position": "å·¥ç¨‹å¸ˆ",
    "mobile": "13800138000"
  }
]
```

**å®ç°è¯´æ˜**:
- éœ€è¦è°ƒç”¨ä¼ä¸šå¾®ä¿¡API: `https://qyapi.weixin.qq.com/cgi-bin/user/list`
- éœ€è¦é…ç½® `CORP_ID` å’Œ `CORP_SECRET`

**å®ç°ä½ç½®å»ºè®®**: `backend/app/routers/wechat.py`  
**ä¸´æ—¶æ–¹æ¡ˆ**: âœ… å‰ç«¯å·²å®ç°ç¤ºä¾‹æ•°æ®é™çº§

---

### 5. ä¼ä¸šå¾®ä¿¡ç¾¤èŠåˆ—è¡¨APIæœªå®ç°
**éœ€è¦å®ç°**: `GET /api/wechat/work/groups`  
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜  
**å½±å“åŠŸèƒ½**: æµ‹è¯•å‘é€ - é€‰æ‹©ç¾¤èŠåŠŸèƒ½  
**é¢„æœŸè¿”å›**:
```json
[
  {
    "chatid": "wrxxx",
    "name": "å†…éƒ¨å·¥ä½œç¾¤",
    "member_count": 25
  }
]
```

**å®ç°è¯´æ˜**:
- éœ€è¦è°ƒç”¨ä¼ä¸šå¾®ä¿¡API: `https://qyapi.weixin.qq.com/cgi-bin/appchat/list`

**å®ç°ä½ç½®å»ºè®®**: `backend/app/routers/wechat.py`  
**ä¸´æ—¶æ–¹æ¡ˆ**: âœ… å‰ç«¯å·²å®ç°ç¤ºä¾‹æ•°æ®é™çº§

---

### 6. å…¬ä¼—å·ç”¨æˆ·åˆ—è¡¨APIæœªå®ç°
**éœ€è¦å®ç°**: `GET /api/wechat/official/users`  
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­  
**å½±å“åŠŸèƒ½**: æµ‹è¯•å‘é€ - é€‰æ‹©å…¬ä¼—å·ç”¨æˆ·  
**é¢„æœŸè¿”å›**:
```json
[
  {
    "openid": "oxxx",
    "nickname": "å¼ ä¸‰",
    "headimgurl": "http://...",
    "subscribe": true,
    "tags": ["VIP"]
  }
]
```

**å®ç°è¯´æ˜**:
- éœ€è¦è°ƒç”¨å¾®ä¿¡å…¬ä¼—å·API: `https://api.weixin.qq.com/cgi-bin/user/get`

**å®ç°ä½ç½®å»ºè®®**: `backend/app/routers/wechat.py`  
**ä¸´æ—¶æ–¹æ¡ˆ**: âœ… å‰ç«¯å·²å®ç°ç¤ºä¾‹æ•°æ®é™çº§

---

### 7. é…ç½®åˆ†ç»„APIæœªå®ç°
**éœ€è¦å®ç°**: `GET /api/admin/config-center/groups`  
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­  
**å½±å“åŠŸèƒ½**: é…ç½®ä¸­å¿ƒ - é…ç½®åˆ†ç»„ç®¡ç†

**å®ç°ä½ç½®å»ºè®®**: `backend/app/routers/config_center.py`

---

### 8. å¾®ä¿¡é…ç½®APIæœªå®ç°
**éœ€è¦å®ç°**: `GET /api/admin/config-center/wechat`  
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­  
**å½±å“åŠŸèƒ½**: é…ç½®ä¸­å¿ƒ - å¾®ä¿¡é…ç½®ç®¡ç†

**å®ç°ä½ç½®å»ºè®®**: `backend/app/routers/config_center.py`

---

### 9. æ•°æ®æºåˆ—è¡¨APIæœªå®ç°
**éœ€è¦å®ç°**: `GET /api/admin/datasources`  
**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½  
**å½±å“åŠŸèƒ½**: æ•°æ®æºç®¡ç†é¡µé¢

**å®ç°ä½ç½®å»ºè®®**: `backend/app/routers/datasource.py`

---

### 10. æ‰€æœ‰AIæ¨¡å‹åˆ—è¡¨APIæœªå®ç°
**éœ€è¦å®ç°**: `GET /api/admin/ai-models`  
**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½  
**å½±å“åŠŸèƒ½**: AIæ¨¡å‹ç®¡ç†é¡µé¢ï¼ˆå®Œæ•´åˆ—è¡¨ï¼‰

**è¯´æ˜**: å½“å‰åªæœ‰ `/api/admin/ai-models/active` å¯ç”¨ï¼ˆè·å–æ¿€æ´»çš„æ¨¡å‹ï¼‰

**å®ç°ä½ç½®å»ºè®®**: `backend/app/routers/ai_model_router.py`

---

## ğŸŸ¢ å·²ä¿®å¤é—®é¢˜å†å²

### âœ… 1. å‰ç«¯Vueç¼–è¯‘é”™è¯¯ï¼ˆå·²ä¿®å¤ï¼‰
**ä¿®å¤æ—¶é—´**: 2026-02-03  
**é—®é¢˜**: TemplateManager.vueä¸­loadAIModelså‡½æ•°çš„try-catchç»“æ„ä¸å®Œæ•´  
**åŸå› **: ä»£ç ç¼–è¾‘æ—¶å‡½æ•°è¢«åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œä¸­é—´æ’å…¥äº†å…¶ä»–å‡½æ•°  
**è§£å†³æ–¹æ¡ˆ**: åˆ é™¤é‡å¤çš„catch/finallyå—ï¼Œç¡®ä¿å‡½æ•°å®Œæ•´æ€§

**ä¿®å¤æ–‡ä»¶**: `frontend/src/views/TemplateManager.vue` (line 1150-1204)

---

### âœ… 2. æ¨¡æ¿åˆ—è¡¨æ˜¾ç¤º"No Data"ï¼ˆå·²ä¿®å¤ï¼‰
**ä¿®å¤æ—¶é—´**: 2026-02-03  
**é—®é¢˜**: æ‰€æœ‰æ ‡ç­¾é¡µæ˜¾ç¤º"No Data"ï¼Œä½†æ•°æ®åº“æœ‰25ä¸ªæ¨¡æ¿  
**åŸå› **: 
1. å‰ç«¯ä½¿ç”¨ `category` å­—æ®µè¿‡æ»¤ï¼Œåº”è¯¥ç”¨ `channel` å­—æ®µ
2. æ•°æ®åº“ `module_type` å’Œ `channel` ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**: 
1. ä¿®æ”¹å‰ç«¯è¿‡æ»¤é€»è¾‘: `t.channel === activeTab.value`
2. ç»Ÿä¸€æ•°æ®åº“å­—æ®µ: `channel = module_type`
3. ä¿®å¤é”™è¯¯åˆ†ç±»çš„æ¨¡æ¿

**ä¿®å¤æ–‡ä»¶**: 
- `frontend/src/views/TemplateManager.vue` (line 1308-1312)
- `backend/fix_channel.py`
- `backend/fix_24.py`

---

### âœ… 3. æ•°æ®åº“æ¨¡æ¿åˆ†ç±»é”™è¯¯ï¼ˆå·²ä¿®å¤ï¼‰
**ä¿®å¤æ—¶é—´**: 2026-02-03  
**é—®é¢˜**: ID 24çš„æ¨¡æ¿åº”è¯¥æ˜¯GROUP_BOTï¼Œä½†è¢«åˆ†ç±»ä¸ºWORK_WECHAT  
**è§£å†³æ–¹æ¡ˆ**: 
```python
UPDATE message_templates 
SET module_type='GROUP_BOT', channel='GROUP_BOT' 
WHERE id=24
```

**ä¿®å¤æ–‡ä»¶**: `backend/fix_24.py`

---

### âœ… 4. åç«¯JSONå­—æ®µè§£æé”™è¯¯ï¼ˆå·²ä¿®å¤ï¼‰
**ä¿®å¤æ—¶é—´**: 2026-02-03  
**é—®é¢˜**: keywordså’Œtargetså­—æ®µä¸ºNULLæ—¶å¯¼è‡´JSONè§£æå¤±è´¥  
**è§£å†³æ–¹æ¡ˆ**: å¢å¼ºå®¹é”™å¤„ç†ï¼Œæ£€æŸ¥å­—æ®µä¸ä¸ºNULLä¸”ä¸ç­‰äºå­—ç¬¦ä¸²"None"

**ä¿®å¤æ–‡ä»¶**: `backend/app/api/template_management.py` (lines 56-66)

---

### âœ… 5. Viteä»£ç†é…ç½®ç«¯å£é”™è¯¯ï¼ˆå·²ä¿®å¤ï¼‰
**ä¿®å¤æ—¶é—´**: 2026-02-03  
**é—®é¢˜**: å‰ç«¯ä»£ç†æŒ‡å‘8000ç«¯å£ï¼Œä½†åç«¯è¿è¡Œåœ¨8001  
**è§£å†³æ–¹æ¡ˆ**: ä¿®æ”¹vite.config.jsä¸­çš„targetä¸º8001

**ä¿®å¤æ–‡ä»¶**: `frontend/vite.config.js`

---

### âœ… 6. å‰ç«¯APIè°ƒç”¨404é”™è¯¯ï¼ˆå·²ä¿®å¤ï¼‰
**ä¿®å¤æ—¶é—´**: 2026-02-03  
**é—®é¢˜**: 4ä¸ªè·å–å‡½æ•°è°ƒç”¨ä¸å­˜åœ¨çš„APIå¯¼è‡´æ§åˆ¶å°æŠ¥é”™  
**è§£å†³æ–¹æ¡ˆ**: æ·»åŠ 404å®¹é”™å¤„ç†ï¼ŒAPIä¸å­˜åœ¨æ—¶æ˜¾ç¤ºå‹å¥½æç¤ºå¹¶åŠ è½½ç¤ºä¾‹æ•°æ®

**ä¿®å¤æ–‡ä»¶**: `frontend/src/views/TemplateManager.vue`
- `loadWechatUsers()` (line 1207-1229)
- `loadWorkStaff()` (line 1232-1254)
- `loadCustomers()` (line 1257-1279)
- `loadGroups()` (line 1282-1304)

---

## ğŸ“ ä¼˜åŒ–å»ºè®®

### 1. APIæ–‡æ¡£ç”Ÿæˆ
**å»ºè®®**: ä½¿ç”¨FastAPIè‡ªå¸¦çš„Swaggeræ–‡æ¡£  
**ä¼˜å…ˆçº§**: ğŸŸ¢ ä½  
**å®ç°æ–¹å¼**:
```python
# åœ¨main.pyä¸­å·²é»˜è®¤å¯ç”¨
# è®¿é—®: http://localhost:8001/docs
```

**ä»·å€¼**: æ–¹ä¾¿å‰åç«¯è”è°ƒï¼Œè‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£

---

### 2. ç»Ÿä¸€é”™è¯¯å¤„ç†
**å»ºè®®**: åˆ›å»ºç»Ÿä¸€çš„é”™è¯¯å“åº”æ ¼å¼  
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­  
**å½“å‰é—®é¢˜**: ä¸åŒAPIè¿”å›çš„é”™è¯¯æ ¼å¼ä¸ç»Ÿä¸€

**å»ºè®®æ ¼å¼**:
```json
{
  "success": false,
  "error": {
    "code": "RESOURCE_NOT_FOUND",
    "message": "æ¨¡æ¿ä¸å­˜åœ¨",
    "details": null
  }
}
```

---

### 3. æ·»åŠ APIå•å…ƒæµ‹è¯•
**å»ºè®®**: ä½¿ç”¨pytestç¼–å†™APIæµ‹è¯•ç”¨ä¾‹  
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­  
**å®ç°ä½ç½®**: `backend/tests/`

**ä»·å€¼**: 
- ç¡®ä¿APIç¨³å®šæ€§
- å›å½’æµ‹è¯•
- æ–‡æ¡£ä½œç”¨

---

## ğŸ” å¿«é€Ÿæ’æŸ¥æŒ‡å—

### åç«¯APIé”™è¯¯æ’æŸ¥
```bash
# 1. æŸ¥çœ‹åç«¯æ—¥å¿—
cd backend
cat server.log | Select-String "ERROR"

# 2. æµ‹è¯•æ‰€æœ‰API
python test_all_apis.py

# 3. æ£€æŸ¥æ•°æ®åº“
sqlite3 customer_system.db
.tables
SELECT * FROM message_templates LIMIT 5;
```

### å‰ç«¯é”™è¯¯æ’æŸ¥
```bash
# 1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
# æ‰“å¼€F12 -> Consoleæ ‡ç­¾

# 2. æ£€æŸ¥Networkæ ‡ç­¾
# æŸ¥çœ‹å¤±è´¥çš„è¯·æ±‚

# 3. æ¸…é™¤ç¼“å­˜å¹¶ç¡¬åˆ·æ–°
# Ctrl + Shift + R
```

### æ•°æ®åº“é—®é¢˜æ’æŸ¥
```bash
# æŸ¥çœ‹è¡¨ç»“æ„
sqlite3 customer_system.db
PRAGMA table_info(message_templates);

# æŸ¥çœ‹æ•°æ®åˆ†å¸ƒ
SELECT module_type, COUNT(*) FROM message_templates GROUP BY module_type;

# æ£€æŸ¥NULLå€¼
SELECT * FROM message_templates WHERE keywords IS NULL;
```

---

## ğŸ“Š é—®é¢˜ç»Ÿè®¡

**æ€»é—®é¢˜æ•°**: 16ä¸ª  
**å·²ä¿®å¤**: 6ä¸ª âœ…  
**å¾…ä¿®å¤**: 10ä¸ª â³  
- ğŸ”´ é«˜ä¼˜å…ˆçº§: 5ä¸ª
- ğŸŸ¡ ä¸­ä¼˜å…ˆçº§: 3ä¸ª  
- ğŸŸ¢ ä½ä¼˜å…ˆçº§: 2ä¸ª

**ä¿®å¤ç‡**: 37.5%  
**å¹³å‡ä¿®å¤æ—¶é—´**: < 1å°æ—¶

---

## ğŸ—‚ï¸ ç›¸å…³æ–‡æ¡£ç´¢å¼•

- [ç³»ç»Ÿå…¨é¢æ’æŸ¥æŠ¥å‘Š](./ç³»ç»Ÿå…¨é¢æ’æŸ¥æŠ¥å‘Š.md) - å®Œæ•´çš„æ’æŸ¥è®°å½•
- [æµ‹è¯•å‘é€-çœŸå®æ•°æ®è·å–åŠŸèƒ½](./æµ‹è¯•å‘é€-çœŸå®æ•°æ®è·å–åŠŸèƒ½.md) - è·å–æŒ‰é’®å®ç°è¯´æ˜
- [æ¶ˆæ¯æ¨¡æ¿æ˜¾ç¤ºé—®é¢˜-ä¿®å¤æŠ¥å‘Š](./æ¶ˆæ¯æ¨¡æ¿æ˜¾ç¤ºé—®é¢˜-ä¿®å¤æŠ¥å‘Š.md) - æ¨¡æ¿æ˜¾ç¤ºé—®é¢˜ä¿®å¤
- [APIæµ‹è¯•è„šæœ¬](./backend/test_all_apis.py) - è‡ªåŠ¨åŒ–APIæµ‹è¯•å·¥å…·

---

## ğŸ“… ç»´æŠ¤æ—¥å¿—

| æ—¥æœŸ | æ“ä½œ | é—®é¢˜æ•°å˜åŒ– |
|------|------|-----------|
| 2026-02-03 | åˆå§‹åˆ›å»º | æ–°å¢16ä¸ªé—®é¢˜è®°å½• |
| 2026-02-03 | ä¿®å¤å‰ç«¯ç¼–è¯‘é”™è¯¯ | ä¿®å¤1ä¸ª |
| 2026-02-03 | ä¿®å¤æ¨¡æ¿æ˜¾ç¤ºé—®é¢˜ | ä¿®å¤3ä¸ª |
| 2026-02-03 | æ·»åŠ APIå®¹é”™å¤„ç† | ä¿®å¤2ä¸ª |

---

**æœ€åæ›´æ–°**: 2026å¹´2æœˆ3æ—¥ 23:59  
**ç»´æŠ¤äºº**: AI Assistant  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
